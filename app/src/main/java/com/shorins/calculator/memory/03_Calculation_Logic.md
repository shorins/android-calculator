# Логика вычислений

Вся логика по обработке вводимых чисел и выполнению математических операций инкапсулирована в `CalculatorViewModel`.

## 1. Ввод чисел и операций

-   **`enterNumber(number: Int)`**: Эта функция добавляет цифру к текущему числу. Она проверяет, в какое из полей (`number1` или `number2`) нужно добавить цифру, основываясь на том, была ли уже выбрана операция (`state.operation`).

-   **`enterOperation(operation: CalculatorOperation)`**: Эта функция сохраняет выбранную математическую операцию в `state.operation`.

## 2. Выполнение вычисления: `performCalculation()`

Это ключевая функция, которая вызывается при нажатии на кнопку "=".

Ее логика разделена на два основных сценария:

### Сценарий 1: Вычисление для одного числа

Это случай, когда пользователь ввел число, добавил знак процента и нажал "=".

```kotlin
// Пример: "50% ="
if (number2String.isBlank() && state.operation == null) {
    if (number1String.contains("%")) {
        val result = parseNumberWithPercentage(number1String)
        // ... обновить состояние результатом
    }
    return
}
```

### Сценарий 2: Вычисление полного выражения

Это стандартный случай, например, "100 + 10%".

1.  **Парсинг чисел**: Функция сначала проверяет, содержит ли строковое представление числа (`number1String`, `number2String`) знак процента.
2.  **Обработка процентов**: Если знак `%` найден, вызывается вспомогательная функция `parseNumberWithPercentage` для вычисления корректного числового значения.
3.  **Выполнение операции**: После получения чистых числовых значений (`num1`, `num2`), блок `when` выполняет соответствующую арифметическую операцию.
4.  **Обработка деления на ноль**: Внутри блока `when` есть проверка `if (num2 == 0.0)`, которая предотвращает падение приложения и устанавливает состояние в "Error".
5.  **Обновление состояния**: Результат вычисления записывается в `state.number1`, а `number2` и `operation` очищаются, подготавливая калькулятор к следующему вычислению.

## 3. Логика вычисления процентов: `parseNumberWithPercentage()`

Эта функция была создана для реализации отложенного вычисления процентов.

```kotlin
private fun parseNumberWithPercentage(
    numberString: String,
    baseNumber: Double? = null,
    operation: CalculatorOperation? = null
): Double?
```

-   Она принимает строку (например, "10%"), базовое число (`number1`) и операцию.
-   **Логика для `+` и `-`**: Если операция — сложение или вычитание, процент вычисляется от базового числа. Например, для `100 + 10%` функция вернет `10` (10% от 100).
-   **Логика для `*` и `÷`**: Если операция — умножение или деление, процент просто преобразуется в десятичную дробь. Например, для `80 * 10%` функция вернет `0.1`.
-   **Логика для одиночного числа**: Если `baseNumber` и `operation` не переданы (случай "50% ="), функция просто вернет `0.5`.
